<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudsoft Inventory & Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF-AutoTable plugin for table generation in PDF -->
    <script src="https://unpkg.com/jspdf-autotable@3.5.20/dist/jspdf.plugin.autotable.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 200px;
            }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background-color: #10B981;
        }
        .notification.error {
            background-color: #EF4444;
        }
        .notification.info {
            background-color: #3B82F6;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            flex-direction: column;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3B82F6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom styles for mobile navigation */
        @media (max-width: 767px) {
            .mobile-nav-hidden {
                display: none;
            }
            .mobile-nav-show {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                margin-top: 1rem;
            }
            .mobile-nav-show button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 text-gray-800 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loader"></div>
        <p class="text-gray-700 font-semibold text-lg">Loading data...</p>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <!-- Main App Content -->
    <div id="appContent" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-lg py-4 border-b border-gray-200">
            <div class="container mx-auto px-4 flex flex-wrap justify-between items-center">
                <div class="flex items-center space-x-3 mb-4 sm:mb-0">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">C</span>
                    </div>
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-800">Cloudsoft Business Manager</h1>
                </div>

                <!-- Hamburger menu for mobile -->
                <button id="mobile-menu-toggle" class="lg:hidden p-2 rounded-md text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>

                <nav id="main-nav" class="w-full lg:w-auto flex-col lg:flex-row lg:flex space-y-2 lg:space-y-0 lg:space-x-2 mobile-nav-hidden">
                    <button id="nav-inventory" class="px-6 py-2 rounded-lg font-semibold text-white bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md">
                        ðŸ“¦ Inventory
                    </button>
                    <button id="nav-tasks" class="px-6 py-2 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-all duration-200">
                        âœ“ Tasks
                    </button>
                    <button id="nav-expenses" class="px-6 py-2 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-all duration-200">
                        ðŸ’¸ Expenses
                    </button>
                </nav>
            </div>
        </header>
        <!-- Main Content Area -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <!-- Auto-save Status -->
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0">
                <div class="flex items-center space-x-2">
                    <span id="autoSaveStatus" class="text-sm text-green-600 font-medium">âœ“ Auto-save enabled (Local Storage)</span>
                </div>
                <div class="flex flex-wrap justify-center sm:justify-end gap-2">
                    <button id="exportDataBtn" class="px-4 py-2 rounded-lg bg-purple-500 text-white font-semibold hover:bg-purple-600 transition-colors shadow-md">
                        ðŸ“„ Export PDF
                    </button>
                    <button id="importDataBtn" class="px-4 py-2 rounded-lg bg-orange-500 text-white font-semibold hover:bg-orange-600 transition-colors shadow-md">
                        ðŸ“¤ Import Data
                    </button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                </div>
            </div>
            <!-- Inventory Section -->
            <section id="inventory-section" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">ðŸ“¦ Inventory Management</h2>
                <p class="text-gray-600 mb-6 text-center text-sm sm:text-base">Manage your product stock here. Add new items, update quantities, and keep track of your inventory value.</p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Add Inventory Form -->
                    <div class="p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white shadow-sm">
                        <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <span class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm mr-2">+</span>
                            Add New Inventory Item
                        </h3>
                        <form id="inventoryForm" class="space-y-4">
                            <div>
                                <label for="productName" class="block text-sm font-medium text-gray-700 mb-1">Product Name</label>
                                <input type="text" id="productName" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Enter product name" required>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                                    <input type="number" id="quantity" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0" required min="0">
                                </div>
                                <div>
                                    <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                    <select id="category" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                        <option value="1PLY">1PLY</option>
                                        <option value="2PLY (200 Sheets)">2PLY (200 Sheets)</option>
                                        <option value="2PLY (350 Sheets)">2PLY (350 Sheets)</option>
                                        <option value="Refuse Bags">Refuse Bags</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="costPrice" class="block text-sm font-medium text-gray-700 mb-1">Cost Price (R)</label>
                                    <input type="number" id="costPrice" step="0.01" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.00" required min="0">
                                </div>
                                <div>
                                    <label for="sellingPrice" class="block text-sm font-medium text-gray-700 mb-1">Selling Price (R)</label>
                                    <input type="number" id="sellingPrice" step="0.01" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.00" required min="0">
                                </div>
                            </div>
                            <button type="submit" class="w-full px-4 py-3 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md">
                                Add Item
                            </button>
                        </form>
                    </div>
                    <!-- Inventory Summary & Chart -->
                    <div class="p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white shadow-sm flex flex-col">
                        <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <span class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white text-sm mr-2">ðŸ“Š</span>
                            Financial Overview
                        </h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <p class="text-sm text-blue-600 font-medium">Total Cost Value</p>
                                <p id="totalCostValue" class="text-xl sm:text-2xl font-bold text-blue-700">R0.00</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <p class="text-sm text-green-600 font-medium">Total Selling Value</p>
                                <p id="totalSellingValue" class="text-xl sm:text-2xl font-bold text-green-700">R0.00</p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <p class="text-sm text-red-600 font-medium">Total Expenses</p>
                                <p id="totalExpensesValue" class="text-xl sm:text-2xl font-bold text-red-700">R0.00</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                <p class="text-sm text-purple-600 font-medium">Net Profit</p>
                                <p id="netProfitValue" class="text-xl sm:text-2xl font-bold text-purple-700">R0.00</p>
                            </div>
                            <!-- New: Total Inventory Count -->
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 col-span-full">
                                <p class="text-sm text-yellow-600 font-medium">Total Inventory Items</p>
                                <p id="totalInventoryCount" class="text-xl sm:text-2xl font-bold text-yellow-700">0</p>
                            </div>
                            <!-- End New: Total Inventory Count -->
                        </div>
                        <div class="flex-grow chart-container">
                            <canvas id="inventoryValueChart"></canvas>
                        </div>
                        <p class="text-sm text-gray-500 mt-4 text-center">Distribution of inventory value by product</p>
                    </div>
                </div>
                <!-- Search and Filter -->
                <div class="mt-8 flex flex-col md:flex-row gap-4 items-center justify-between">
                    <div class="flex-1 w-full md:max-w-md">
                        <input type="text" id="searchInventory" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="ðŸ” Search inventory...">
                    </div>
                    <div class="flex flex-wrap justify-center gap-2">
                        <select id="filterCategory" class="border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <option value="">All Categories</option>
                            <option value="1PLY">1PLY</option>
                            <option value="2PLY (200 Sheets)">2PLY (200 Sheets)</option>
                            <option value="2PLY (350 Sheets)">2PLY (350 Sheets)</option>
                            <option value="Refuse Bags">Refuse Bags</option>
                            <option value="Other">Other</option>
                        </select>
                        <button id="clearFilters" class="px-4 py-2 rounded-lg bg-gray-500 text-white font-semibold hover:bg-gray-600 transition-colors">
                            Clear
                        </button>
                    </div>
                </div>
                <!-- Inventory List -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Current Inventory</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
                            <thead>
                                <tr class="bg-gradient-to-r from-gray-100 to-gray-200 text-left text-sm font-medium text-gray-700 uppercase tracking-wider">
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Product Name</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Category</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Quantity</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Cost Price</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Selling Price</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Total Value</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryList" class="divide-y divide-gray-200">
                                <!-- Inventory items will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                    <p id="noInventoryMessage" class="text-center text-gray-500 mt-8 hidden">
                        <span class="text-4xl">ðŸ“¦</span><br>
                        No inventory items found.<br>
                        <span class="text-sm">Add your first item using the form above.</span>
                    </p>
                </div>
            </section>
            <!-- Tasks Section -->
            <section id="tasks-section" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">âœ“ Task Management</h2>
                <p class="text-gray-600 mb-6 text-center text-sm sm:text-base">Keep track of your business tasks. Add new tasks, mark them as complete, or edit details.</p>
                <div class="p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white shadow-sm mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white text-sm mr-2">+</span>
                        Add New Task
                    </h3>
                    <form id="taskForm" class="space-y-4">
                        <div>
                            <label for="taskDescription" class="block text-sm font-medium text-gray-700 mb-1">Task Description</label>
                            <textarea id="taskDescription" rows="3" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Enter task description..." required></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="taskDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                                <input type="date" id="taskDueDate" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            <div>
                                <label for="taskPriority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select id="taskPriority" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="w-full px-4 py-3 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-md">
                            Add Task
                        </button>
                    </form>
                </div>
                <!-- Task Filters -->
                <div class="flex flex-wrap gap-2 mb-6 justify-center sm:justify-start">
                    <button id="filterAll" class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition-colors text-sm">All</button>
                    <button id="filterPending" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">Pending</button>
                    <button id="filterCompleted" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">Completed</button>
                    <button id="filterHigh" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors text-sm">High Priority</button>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Current Tasks</h3>
                    <div id="taskList" class="space-y-4">
                        <!-- Tasks will be rendered here -->
                    </div>
                    <p id="noTasksMessage" class="text-center text-gray-500 mt-8 hidden">
                        <span class="text-4xl">ðŸ“‹</span><br>
                        No tasks found.<br>
                        <span class="text-sm">Add your first task using the form above.</span>
                    </p>
                </div>
            </section>

            <!-- Expenses Section -->
            <section id="expenses-section" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hidden">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">ðŸ’¸ Expense Management</h2>
                <p class="text-gray-600 mb-6 text-center text-sm sm:text-base">Track your business expenses to get a clearer picture of your net profit.</p>
                <div class="p-6 border border-gray-200 rounded-xl bg-gradient-to-br from-gray-50 to-white shadow-sm mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-6 h-6 bg-red-500 rounded-full flex items-center justify-center text-white text-sm mr-2">+</span>
                        Add New Expense
                    </h3>
                    <form id="expenseForm" class="space-y-4">
                        <div>
                            <label for="expenseName" class="block text-sm font-medium text-gray-700 mb-1">Expense Name</label>
                            <input type="text" id="expenseName" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="e.g., Office Rent, Marketing, Utilities" required>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="expenseAmount" class="block text-sm font-medium text-gray-700 mb-1">Amount (R)</label>
                                <input type="number" id="expenseAmount" step="0.01" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" placeholder="0.00" required min="0">
                            </div>
                            <div>
                                <label for="expenseDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="expenseDate" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all" required>
                            </div>
                        </div>
                        <div>
                            <label for="expenseCategory" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="expenseCategory" class="w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                                <option value="Operating">Operating</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Logistics">Logistics</option>
                                <option value="Salaries">Salaries</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full px-4 py-3 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-md">
                            Add Expense
                        </button>
                    </form>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Expense List</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
                            <thead>
                                <tr class="bg-gradient-to-r from-gray-100 to-gray-200 text-left text-sm font-medium text-gray-700 uppercase tracking-wider">
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Expense Name</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Category</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Amount</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Date</th>
                                    <th class="py-4 px-3 sm:px-6 border-b border-gray-200">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expenseList" class="divide-y divide-gray-200">
                                <!-- Expenses will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                    <p id="noExpensesMessage" class="text-center text-gray-500 mt-8 hidden">
                        <span class="text-4xl">ðŸ’¸</span><br>
                        No expenses recorded.<br>
                        <span class="text-sm">Add your first expense using the form above.</span>
                    </p>
                </div>
            </section>
        </main>
    </div>
    <script>
        // --- Application Data ---
        let inventory = [];
        let tasks = [];
        let expenses = [];
        let inventoryChart = null;
        let currentTaskFilter = 'all';

        // --- DOM Elements ---
        const loadingOverlay = document.getElementById('loadingOverlay');
        const inventoryForm = document.getElementById('inventoryForm');
        const inventoryList = document.getElementById('inventoryList');
        const noInventoryMessage = document.getElementById('noInventoryMessage');
        const totalCostValue = document.getElementById('totalCostValue');
        const totalSellingValue = document.getElementById('totalSellingValue');
        const totalExpensesValue = document.getElementById('totalExpensesValue');
        const netProfitValue = document.getElementById('netProfitValue');
        const inventoryValueChartCanvas = document.getElementById('inventoryValueChart');
        const searchInventory = document.getElementById('searchInventory');
        const filterCategory = document.getElementById('filterCategory');
        const clearFilters = document.getElementById('clearFilters');
        const taskForm = document.getElementById('taskForm');
        const taskList = document.getElementById('taskList');
        const noTasksMessage = document.getElementById('noTasksMessage');
        const expenseForm = document.getElementById('expenseForm');
        const expenseList = document.getElementById('expenseList');
        const noExpensesMessage = document.getElementById('noExpensesMessage');
        const navInventory = document.getElementById('nav-inventory');
        const navTasks = document.getElementById('nav-tasks');
        const navExpenses = document.getElementById('nav-expenses');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const importFileInput = document.getElementById('importFileInput');
        const notification = document.getElementById('notification');
        const autoSaveStatus = document.getElementById('autoSaveStatus');
        const totalInventoryCount = document.getElementById('totalInventoryCount');

        // Task Filter Buttons
        const filterAll = document.getElementById('filterAll');
        const filterPending = document.getElementById('filterPending');
        const filterCompleted = document.getElementById('filterCompleted');
        const filterHigh = document.getElementById('filterHigh');

        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mainNav = document.getElementById('main-nav');

        // --- Utility Functions ---
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showLoading(message = 'Loading data...') {
            loadingOverlay.querySelector('p').textContent = message;
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        function renderAllSections() {
            renderInventory();
            renderTasks();
            renderExpenses();
            updateOverallFinancialSummary();
        }

        function wrapLabel(label, maxLength = 16) {
            if (label.length <= maxLength) {
                return label;
            }
            const words = label.split(' ');
            let lines = [];
            let currentLine = '';
            for (let word of words) {
                if ((currentLine + word).length > maxLength && currentLine.length > 0) {
                    lines.push(currentLine.trim());
                    currentLine = word + ' ';
                } else {
                    currentLine += word + ' ';
                }
            }
            lines.push(currentLine.trim());
            return lines;
        }

        function getPriorityColor(priority) {
            switch (priority) {
                case 'High': return 'bg-red-100 border-red-300 text-red-800';
                case 'Medium': return 'bg-yellow-100 border-yellow-300 text-yellow-800';
                case 'Low': return 'bg-green-100 border-green-300 text-green-800';
                default: return 'bg-gray-100 border-gray-300 text-gray-800';
            }
        }

        // --- Local Storage Data Operations ---
        function saveDataToLocalStorage() {
            const appData = {
                inventory: inventory,
                tasks: tasks,
                expenses: expenses,
                lastSaved: new Date().toISOString()
            };
            try {
                localStorage.setItem('cloudsoft_app_data', JSON.stringify(appData));
                autoSaveStatus.textContent = `âœ“ Last saved: ${new Date().toLocaleTimeString()}`;
                // No notification for every auto-save to avoid spamming, but useful for debugging
                // showNotification('Data saved to local storage!', 'success');
            } catch (e) {
                console.error("Error saving to local storage: ", e);
                autoSaveStatus.textContent = 'âš  Local save failed';
                showNotification('Error saving data locally.', 'error');
            }
        }

        function loadDataFromLocalStorage() {
            showLoading('Loading data from local storage...');
            try {
                const storedData = localStorage.getItem('cloudsoft_app_data');
                if (storedData) {
                    const loadedData = JSON.parse(storedData);
                    inventory = loadedData.inventory || [];
                    tasks = loadedData.tasks || [];
                    expenses = loadedData.expenses || [];
                    autoSaveStatus.textContent = `âœ“ Last loaded: ${new Date().toLocaleTimeString()}`;
                    showNotification('Data loaded from local storage!', 'success');
                } else {
                    console.log("No data found in local storage. Starting fresh.");
                    showNotification('No saved data found. Starting fresh.', 'info');
                }
            } catch (e) {
                console.error("Error loading from local storage: ", e);
                showNotification('Error loading data from local storage.', 'error');
            } finally {
                hideLoading();
            }
        }

        // --- Inventory Functions ---
        function addInventoryItem(event) {
            event.preventDefault();
            const productName = document.getElementById('productName').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value);
            const category = document.getElementById('category').value;
            const costPrice = parseFloat(document.getElementById('costPrice').value);
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value);

            if (!productName || isNaN(quantity) || quantity < 0 || isNaN(costPrice) || costPrice < 0 || isNaN(sellingPrice) || sellingPrice < 0) {
                showNotification('Please fill in all fields with valid numbers (quantity, cost, selling price cannot be negative).', 'error');
                return;
            }

            const totalValue = quantity * sellingPrice;

            inventory.push({
                id: Date.now(),
                productName,
                quantity,
                category,
                costPrice,
                sellingPrice,
                totalValue
            });
            saveDataToLocalStorage();
            renderInventory();
            updateOverallFinancialSummary();
            inventoryForm.reset();
            showNotification('Inventory item added successfully!', 'success');
        }

        function renderInventory(searchTerm = '', filterCat = '') {
            inventoryList.innerHTML = '';
            let filteredInventory = inventory;

            if (searchTerm) {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                filteredInventory = filteredInventory.filter(item =>
                    item.productName.toLowerCase().includes(lowerCaseSearchTerm) ||
                    item.category.toLowerCase().includes(lowerCaseSearchTerm)
                );
            }

            if (filterCat) {
                filteredInventory = filteredInventory.filter(item => item.category === filterCat);
            }

            if (filteredInventory.length === 0) {
                noInventoryMessage.classList.remove('hidden');
            } else {
                noInventoryMessage.classList.add('hidden');
                filteredInventory.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors fade-in';
                    row.innerHTML = `
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">${item.productName}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">${item.category}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">
                            <input type="number" value="${item.quantity}" min="0" data-id="${item.id}" data-field="quantity"
                                class="w-20 p-1 border rounded-md text-sm focus:ring-blue-400 focus:border-blue-400 quantity-input">
                        </td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">R${item.costPrice.toFixed(2)}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">
                            <input type="number" value="${item.sellingPrice.toFixed(2)}" step="0.01" min="0" data-id="${item.id}" data-field="sellingPrice"
                                class="w-24 p-1 border rounded-md text-sm focus:ring-blue-400 focus:border-blue-400 selling-price-input">
                        </td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200 font-semibold">R${(item.quantity * item.sellingPrice).toFixed(2)}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">
                            <button data-id="${item.id}" class="delete-inventory-btn text-red-600 hover:text-red-800 transition-colors p-1 rounded-full hover:bg-red-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 011-1h4a1 1 0 110 2H9a1 1 0 01-1-1zm0 3a1 1 0 011-1h4a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </td>
                    `;
                    inventoryList.appendChild(row);
                });
            }
            attachInventoryEventListeners();
        }

        function attachInventoryEventListeners() {
            document.querySelectorAll('.delete-inventory-btn').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    inventory = inventory.filter(item => item.id !== id);
                    saveDataToLocalStorage();
                    renderInventory();
                    updateOverallFinancialSummary();
                    showNotification('Inventory item deleted.', 'info');
                };
            });

            document.querySelectorAll('.quantity-input, .selling-price-input').forEach(input => {
                input.onchange = (e) => {
                    const id = parseInt(e.target.dataset.id);
                    const field = e.target.dataset.field;
                    let value = parseFloat(e.target.value);

                    if (isNaN(value) || value < 0) {
                        showNotification('Quantity and price must be non-negative numbers.', 'error');
                        renderInventory(searchInventory.value, filterCategory.value); // Re-render to revert invalid input
                        return;
                    }

                    const itemIndex = inventory.findIndex(item => item.id === id);
                    if (itemIndex > -1) {
                        inventory[itemIndex][field] = value;
                        inventory[itemIndex].totalValue = inventory[itemIndex].quantity * inventory[itemIndex].sellingPrice;
                        saveDataToLocalStorage();
                        renderInventory(searchInventory.value, filterCategory.value); // Re-render to update total value and ensure consistency
                        updateOverallFinancialSummary();
                        showNotification('Inventory updated!', 'success');
                    }
                };
            });
        }


        function updateOverallFinancialSummary() {
            const totalCost = inventory.reduce((sum, item) => sum + (item.quantity * item.costPrice), 0);
            const totalSelling = inventory.reduce((sum, item) => sum + (item.quantity * item.sellingPrice), 0);
            const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const netProfit = totalSelling - totalCost - totalExpenses;
            const totalItemsCount = inventory.length;

            totalCostValue.textContent = `R${totalCost.toFixed(2)}`;
            totalSellingValue.textContent = `R${totalSelling.toFixed(2)}`;
            totalExpensesValue.textContent = `R${totalExpenses.toFixed(2)}`;
            netProfitValue.textContent = `R${netProfit.toFixed(2)}`;
            totalInventoryCount.textContent = totalItemsCount;

            updateInventoryValueChart();
        }

        function updateInventoryValueChart() {
            if (inventoryChart) {
                inventoryChart.destroy();
            }

            const chartData = inventory.map(item => ({
                label: item.productName,
                value: item.quantity * item.sellingPrice
            }));

            // Sort and take top N, or all if less than N
            chartData.sort((a, b) => b.value - a.value);
            const topItems = chartData.slice(0, 5); // Show top 5 items by value

            const labels = topItems.map(item => wrapLabel(item.label));
            const data = topItems.map(item => item.value);

            inventoryChart = new Chart(inventoryValueChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#6366F1',
                            '#06B6D4', '#EC4899', '#84CC16', '#F97316', '#6B7280'
                        ],
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 20,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Inventory Value Distribution (Top 5)',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: '#374151'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += 'R' + context.parsed.toFixed(2);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    layout: {
                        padding: 10
                    }
                }
            });
        }

        // --- Task Functions ---
        function addTask(event) {
            event.preventDefault();
            const description = document.getElementById('taskDescription').value.trim();
            const dueDate = document.getElementById('taskDueDate').value;
            const priority = document.getElementById('taskPriority').value;

            if (!description) {
                showNotification('Task description cannot be empty.', 'error');
                return;
            }

            tasks.push({
                id: Date.now(),
                description,
                dueDate,
                priority,
                completed: false
            });
            saveDataToLocalStorage();
            renderTasks();
            taskForm.reset();
            showNotification('Task added successfully!', 'success');
        }

        function renderTasks() {
            taskList.innerHTML = '';
            let filteredTasks = tasks;

            if (currentTaskFilter === 'pending') {
                filteredTasks = tasks.filter(task => !task.completed);
            } else if (currentTaskFilter === 'completed') {
                filteredTasks = tasks.filter(task => task.completed);
            } else if (currentTaskFilter === 'high') {
                filteredTasks = tasks.filter(task => task.priority === 'High' && !task.completed);
            }

            if (filteredTasks.length === 0) {
                noTasksMessage.classList.remove('hidden');
            } else {
                noTasksMessage.classList.add('hidden');
                filteredTasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    const priorityColorClass = getPriorityColor(task.priority);
                    taskElement.className = `p-4 border ${priorityColorClass} rounded-lg shadow-sm flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-2 sm:space-y-0 fade-in ${task.completed ? 'opacity-60 line-through' : ''}`;
                    taskElement.innerHTML = `
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 text-lg">${task.description}</h4>
                            <p class="text-gray-600 text-sm">Due: ${task.dueDate || 'No Due Date'} | Priority: <span class="font-medium">${task.priority}</span></p>
                        </div>
                        <div class="flex space-x-2 mt-2 sm:mt-0">
                            <button data-id="${task.id}" class="toggle-task-btn px-3 py-1 rounded-md text-white font-semibold transition-colors
                                ${task.completed ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-500 hover:bg-green-600'}">
                                ${task.completed ? 'Unmark' : 'Complete'}
                            </button>
                            <button data-id="${task.id}" class="delete-task-btn px-3 py-1 rounded-md bg-red-500 text-white font-semibold hover:bg-red-600 transition-colors">
                                Delete
                            </button>
                        </div>
                    `;
                    taskList.appendChild(taskElement);
                });
            }
            attachTaskEventListeners();
            updateTaskFilterButtons();
        }

        function attachTaskEventListeners() {
            document.querySelectorAll('.toggle-task-btn').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    const taskIndex = tasks.findIndex(task => task.id === id);
                    if (taskIndex > -1) {
                        tasks[taskIndex].completed = !tasks[taskIndex].completed;
                        saveDataToLocalStorage();
                        renderTasks();
                        showNotification(`Task marked as ${tasks[taskIndex].completed ? 'completed' : 'pending'}.`, 'info');
                    }
                };
            });

            document.querySelectorAll('.delete-task-btn').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    tasks = tasks.filter(task => task.id !== id);
                    saveDataToLocalStorage();
                    renderTasks();
                    showNotification('Task deleted.', 'info');
                };
            });
        }

        function updateTaskFilterButtons() {
            filterAll.classList.remove('bg-blue-500', 'text-white');
            filterAll.classList.add('bg-gray-200', 'text-gray-700');
            filterPending.classList.remove('bg-blue-500', 'text-white');
            filterPending.classList.add('bg-gray-200', 'text-gray-700');
            filterCompleted.classList.remove('bg-blue-500', 'text-white');
            filterCompleted.classList.add('bg-gray-200', 'text-gray-700');
            filterHigh.classList.remove('bg-blue-500', 'text-white');
            filterHigh.classList.add('bg-gray-200', 'text-gray-700');

            if (currentTaskFilter === 'all') {
                filterAll.classList.add('bg-blue-500', 'text-white');
                filterAll.classList.remove('bg-gray-200', 'text-gray-700');
            } else if (currentTaskFilter === 'pending') {
                filterPending.classList.add('bg-blue-500', 'text-white');
                filterPending.classList.remove('bg-gray-200', 'text-gray-700');
            } else if (currentTaskFilter === 'completed') {
                filterCompleted.classList.add('bg-blue-500', 'text-white');
                filterCompleted.classList.remove('bg-gray-200', 'text-gray-700');
            } else if (currentTaskFilter === 'high') {
                filterHigh.classList.add('bg-blue-500', 'text-white');
                filterHigh.classList.remove('bg-gray-200', 'text-gray-700');
            }
        }

        // --- Expense Functions ---
        function addExpense(event) {
            event.preventDefault();
            const expenseName = document.getElementById('expenseName').value.trim();
            const expenseAmount = parseFloat(document.getElementById('expenseAmount').value);
            const expenseDate = document.getElementById('expenseDate').value;
            const expenseCategory = document.getElementById('expenseCategory').value;

            if (!expenseName || isNaN(expenseAmount) || expenseAmount < 0 || !expenseDate) {
                showNotification('Please fill in all expense fields with valid data.', 'error');
                return;
            }

            expenses.push({
                id: Date.now(),
                name: expenseName,
                amount: expenseAmount,
                date: expenseDate,
                category: expenseCategory
            });
            saveDataToLocalStorage();
            renderExpenses();
            updateOverallFinancialSummary();
            expenseForm.reset();
            showNotification('Expense added successfully!', 'success');
        }

        function renderExpenses() {
            expenseList.innerHTML = '';
            if (expenses.length === 0) {
                noExpensesMessage.classList.remove('hidden');
            } else {
                noExpensesMessage.classList.add('hidden');
                expenses.forEach(expense => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors fade-in';
                    row.innerHTML = `
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">${expense.name}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">${expense.category}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200 font-semibold">R${expense.amount.toFixed(2)}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">${expense.date}</td>
                        <td class="py-3 px-3 sm:px-6 border-b border-gray-200">
                            <button data-id="${expense.id}" class="delete-expense-btn text-red-600 hover:text-red-800 transition-colors p-1 rounded-full hover:bg-red-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 011-1h4a1 1 0 110 2H9a1 1 0 01-1-1zm0 3a1 1 0 011-1h4a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </td>
                    `;
                    expenseList.appendChild(row);
                });
            }
            attachExpenseEventListeners();
        }

        function attachExpenseEventListeners() {
            document.querySelectorAll('.delete-expense-btn').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    expenses = expenses.filter(expense => expense.id !== id);
                    saveDataToLocalStorage();
                    renderExpenses();
                    updateOverallFinancialSummary();
                    showNotification('Expense deleted.', 'info');
                };
            });
        }

        // --- Navigation Logic ---
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            // Update active navigation button style
            navInventory.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'hover:from-blue-600', 'hover:to-blue-700', 'text-white');
            navInventory.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            navTasks.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700', 'text-white');
            navTasks.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            navExpenses.classList.remove('bg-gradient-to-r', 'from-red-500', 'to-red-600', 'hover:from-red-600', 'hover:to-red-700', 'text-white');
            navExpenses.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');

            if (sectionId === 'inventory-section') {
                navInventory.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'hover:from-blue-600', 'hover:to-blue-700', 'text-white');
                navInventory.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            } else if (sectionId === 'tasks-section') {
                navTasks.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700', 'text-white');
                navTasks.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            } else if (sectionId === 'expenses-section') {
                navExpenses.classList.add('bg-gradient-to-r', 'from-red-500', 'to-red-600', 'hover:from-red-600', 'hover:to-red-700', 'text-white');
                navExpenses.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            }

            // Hide mobile menu if open after selection
            if (!mainNav.classList.contains('mobile-nav-hidden') && window.innerWidth < 768) {
                mainNav.classList.add('mobile-nav-hidden');
                mainNav.classList.remove('mobile-nav-show');
            }
        }

        // --- Export/Import Functions ---
        function exportData() {
            showLoading('Preparing PDF export...');
            setTimeout(() => { // Simulate loading time for PDF generation
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Title
                    doc.setFontSize(22);
                    doc.text("Cloudsoft Business Manager Report", 10, 20);
                    doc.setFontSize(10);
                    doc.text(`Report Date: ${new Date().toLocaleDateString()}`, 10, 27);

                    let yPos = 40;

                    // Inventory Section
                    doc.setFontSize(16);
                    doc.text("ðŸ“¦ Inventory Overview", 10, yPos);
                    yPos += 10;

                    const inventoryHeaders = [['Product Name', 'Category', 'Quantity', 'Cost Price (R)', 'Selling Price (R)', 'Total Value (R)']];
                    const inventoryData = inventory.map(item => [
                        item.productName,
                        item.category,
                        item.quantity,
                        item.costPrice.toFixed(2),
                        item.sellingPrice.toFixed(2),
                        (item.quantity * item.sellingPrice).toFixed(2)
                    ]);

                    doc.autoTable({
                        startY: yPos,
                        head: inventoryHeaders,
                        body: inventoryData,
                        theme: 'grid',
                        headStyles: { fillColor: [59, 130, 246] }, // Blue-500
                        styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak' },
                        didDrawPage: function (data) {
                            yPos = data.cursor.y + 10; // Update yPos after table
                        }
                    });

                    // Financial Summary
                    doc.setFontSize(14);
                    doc.text("ðŸ“Š Financial Summary", 10, doc.autoTable.previous.finalY + 15);
                    doc.setFontSize(10);
                    const financialSummary = [
                        ['Total Cost Value:', `R${inventory.reduce((sum, item) => sum + (item.quantity * item.costPrice), 0).toFixed(2)}`],
                        ['Total Selling Value:', `R${inventory.reduce((sum, item) => sum + (item.quantity * item.sellingPrice), 0).toFixed(2)}`],
                        ['Total Expenses:', `R${expenses.reduce((sum, expense) => sum + expense.amount, 0).toFixed(2)}`],
                        ['Net Profit:', `R${(inventory.reduce((sum, item) => sum + (item.quantity * item.sellingPrice), 0) - inventory.reduce((sum, item) => sum + (item.quantity * item.costPrice), 0) - expenses.reduce((sum, expense) => sum + expense.amount, 0)).toFixed(2)}`]
                    ];
                    doc.autoTable({
                        startY: doc.autoTable.previous.finalY + 20,
                        body: financialSummary,
                        theme: 'plain',
                        styles: { fontSize: 10, cellPadding: 2 },
                        columnStyles: { 0: { fontStyle: 'bold' } },
                        didDrawPage: function (data) {
                            yPos = data.cursor.y + 10;
                        }
                    });


                    // Tasks Section
                    if (tasks.length > 0) {
                        doc.addPage();
                        yPos = 20; // Reset yPos for new page
                        doc.setFontSize(16);
                        doc.text("âœ“ Task List", 10, yPos);
                        yPos += 10;

                        const taskHeaders = [['Description', 'Due Date', 'Priority', 'Status']];
                        const taskData = tasks.map(task => [
                            task.description,
                            task.dueDate || 'N/A',
                            task.priority,
                            task.completed ? 'Completed' : 'Pending'
                        ]);

                        doc.autoTable({
                            startY: yPos,
                            head: taskHeaders,
                            body: taskData,
                            theme: 'grid',
                            headStyles: { fillColor: [16, 185, 129] }, // Green-500
                            styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak' }
                        });
                    }

                    // Expenses Section
                    if (expenses.length > 0) {
                        doc.addPage();
                        yPos = 20; // Reset yPos for new page
                        doc.setFontSize(16);
                        doc.text("ðŸ’¸ Expense List", 10, yPos);
                        yPos += 10;

                        const expenseHeaders = [['Name', 'Category', 'Amount (R)', 'Date']];
                        const expenseData = expenses.map(expense => [
                            expense.name,
                            expense.category,
                            expense.amount.toFixed(2),
                            expense.date
                        ]);

                        doc.autoTable({
                            startY: yPos,
                            head: expenseHeaders,
                            body: expenseData,
                            theme: 'grid',
                            headStyles: { fillColor: [239, 68, 68] }, // Red-500
                            styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak' }
                        });
                    }

                    doc.save('Cloudsoft_Business_Report.pdf');
                    showNotification('PDF exported successfully!', 'success');
                } catch (error) {
                    console.error("Error exporting PDF:", error);
                    showNotification('Error exporting PDF. Please try again.', 'error');
                } finally {
                    hideLoading();
                }
            }, 1000); // Small delay for effect
        }

        function importData() {
            importFileInput.click(); // Trigger file input click
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            if (file.type !== 'application/json') {
                showNotification('Please select a JSON file.', 'error');
                return;
            }

            showLoading('Importing data...');
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData.inventory && importedData.tasks && importedData.expenses) {
                        inventory = importedData.inventory;
                        tasks = importedData.tasks;
                        expenses = importedData.expenses;
                        saveDataToLocalStorage(); // Save imported data to local storage
                        renderAllSections();
                        showNotification('Data imported successfully!', 'success');
                    } else {
                        showNotification('Invalid JSON file format. Missing inventory, tasks, or expenses data.', 'error');
                    }
                } catch (error) {
                    console.error("Error parsing imported JSON:", error);
                    showNotification('Error processing file. Invalid JSON format.', 'error');
                } finally {
                    hideLoading();
                    event.target.value = ''; // Clear file input
                }
            };
            reader.onerror = () => {
                showNotification('Error reading file.', 'error');
                hideLoading();
                event.target.value = ''; // Clear file input
            };
            reader.readAsText(file);
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            loadDataFromLocalStorage();
            renderAllSections();
            showSection('inventory-section'); // Show inventory section by default
        });

        inventoryForm.addEventListener('submit', addInventoryItem);
        taskForm.addEventListener('submit', addTask);
        expenseForm.addEventListener('submit', addExpense);

        navInventory.addEventListener('click', () => showSection('inventory-section'));
        navTasks.addEventListener('click', () => showSection('tasks-section'));
        navExpenses.addEventListener('click', () => showSection('expenses-section'));

        searchInventory.addEventListener('input', (e) => renderInventory(e.target.value, filterCategory.value));
        filterCategory.addEventListener('change', (e) => renderInventory(searchInventory.value, e.target.value));
        clearFilters.addEventListener('click', () => {
            searchInventory.value = '';
            filterCategory.value = '';
            renderInventory('', '');
            showNotification('Inventory filters cleared.', 'info');
        });

        filterAll.addEventListener('click', () => { currentTaskFilter = 'all'; renderTasks(); });
        filterPending.addEventListener('click', () => { currentTaskFilter = 'pending'; renderTasks(); });
        filterCompleted.addEventListener('click', () => { currentTaskFilter = 'completed'; renderTasks(); });
        filterHigh.addEventListener('click', () => { currentTaskFilter = 'high'; renderTasks(); });

        exportDataBtn.addEventListener('click', exportData);
        importDataBtn.addEventListener('click', importData);
        importFileInput.addEventListener('change', handleFileImport);

        // Mobile menu toggle listener
        mobileMenuToggle.addEventListener('click', () => {
            mainNav.classList.toggle('mobile-nav-hidden');
            mainNav.classList.toggle('mobile-nav-show');
        });
    </script>
</body>
</html>
